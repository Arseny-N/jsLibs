<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foundation</title>
    <link rel="stylesheet" href="css/app.css" />
    <script src="bower_components/modernizr/modernizr.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
  </head>
  <body>
  	<br>  	<br>  	<br>
  	  	<br>  	<br>  	<br>
  	<div class="dyn-form">
	<div class="panel">
  		<div class="row">
        		<div class="small-8 small-centered columns">
        			<div class="text-center answer-container hide">
	
			        </div>   
			        <div class="text-center greet-container">
					Краинее сложные вычисления...
			        </div>         
				
				<div class="text-center progress-bar" style="margin-top:40px">
					<input type="text"  value="1" data-width="150" data-min="0"
						data-max="100" data-displayInput=false >
				</div>      
			 </div>
		 </div>
	 </div>
 	<div class="row">
       		<div class="small-8 small-centered columns">
			 <div class="panel feed-back-container hide">
	 
				 <div class="row">
			    	 	<div class="small-12 small-centered columns text-center">
						<a href="http://arseny-n.github.io/jsLibs/dyn-form/" class="button small">
						Пройти ntcn</a>
			    	 	</div>
			    	 </div>
	    			 <div class="row">
			    	 	<div class="small-12 small-centered columns text-center">
	    		 	           <div class="pluso" data-background="transparent" 
	    		 	           	data-options="medium,square,line,horizontal,nocounter,theme=06" 
	    		 	           	data-services="vkontakte,odnoklassniki,facebook,twitter,google,moimir,email,print,bookmark"></div>
	    	 	 		</div>
	    			 </div>
			</div>	    	 	 		
	    	 </div>
	</div>

	
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="js/dyn-form.js"></script>
    <script src="js/jquery.knob.js"></script>
    <script type="text/javascript">
    (function() {
		if (window.pluso)
			if (typeof window.pluso.start == "function") return;
  		if (window.ifpluso==undefined) { 
  			window.ifpluso = 1;
    			var d = document, s = d.createElement('script'), g = 'getElementsByTagName';
    			s.type = 'text/javascript'; s.charset='UTF-8'; s.async = true;
    			s.src = ('https:' == window.location.protocol ? 'https' : 'http')  + '://share.pluso.ru/pluso-like.js';
    			var h=d[g]('body')[0];
    			h.appendChild(s);
  		}
  	})();
  	</script>
	<script>
	var messages = [
		{ 
			ignore : true,
			text : 'Вы не прошли теста, пройдите его.'
		},
		{ 
			range : [0, 50],
			text : 'У вас нет туберкулёза.'
		},
		{ 
			range : [51, 100],
			text : '%result % что туберкулёз у вас есть.'
		}
	]
	$(function(){
		function getUrlVars() {
			var vars = [], hash;
			var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
			for(var i = 0; i < hashes.length; i++) {
		        	hash = hashes[i].split('=');
        			vars.push(hash[0]);
        			vars[hash[0]] = hash[1];
    			}
    			return vars;
		
		}
		var result  = getUrlVars()['result'];
		var resInt = parseInt(result);

		for(var i in messages) {
			var msg = messages[i];
			if( !msg.ignore && msg.range[0] <= resInt &&  resInt <= msg.range[1] ) 
				break;
			
		}
		if( msg.range[0] >= resInt ||  resInt >= msg.range[1] || result === undefined) 
			msg = messages[0];

		var e = {};
		e.greet = $("div.greet-container");
		e.answer = $("div.answer-container");
		e.fb = $("div.feed-back-container");
		
		e.bar = {};
		e.bar.input = $(".progress-bar input");
		e.bar.root = $("div.progress-bar");
		
		$('.answer-container').html(msg.text.replace('%result', result));
		e.bar.input.knob({
			readOnly : true
		});
		var progress = 0;
		var interval = setInterval( function() {
					progress = Math.min( progress + 0.05, 1 );
					e.bar.input.val(progress * 100).trigger('change');
					if( progress === 1 ) {
						clearInterval( interval );
						e.bar.root.slideUp();
						e.greet.slideUp();
						e.answer.slideDown();
						e.fb.slideDown();
						
					}
					
		}, 150 );
		
	})
	</script>
  </body>
</html>
