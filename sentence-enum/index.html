<html lang="rus">
<head>
	<meta http-equiv="Content-type" content="text/html;charset=utf-8" />
	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>	
	<script>
		$(function(){
			var Parser = function(text, mode){
				this.text = text;
				this.parsed = [];
				this.reparse = false;
				this.pfuncs = {
					reparse : {
						regexp : /[\d\(\)]* *[\u0410-\u042f][^.!?]*[ .!?\t\n]*/g,
						push_text : function(arr, text, index) {
							index_old = text.match(/\(([0-9]*)\)/);
							text = text.replace(/\([0-9]*\)/, "");	
							indexed = false;
							if(index_old)
								indexed = true;
							else
								console.log(text);
							arr.push({"index":index,"indexed": indexed,"text":text});
						},
						get_text : function(arr_elem) {
								//console.dir(arr_elem);
							if(arr_elem.indexed)
								return "("+arr_elem.index+")"+arr_elem.text;	
							else
								return arr_elem.text;	
						},
						adj_indexes : function(arr) {
							var j=0;
							console.log("hello")
							for(var i in arr) {	
								var e = arr[i];
								if(e.indexed) {
									e.index = j++;
								} else {
						console.dir(e)						
								}
							}
							
						}
					},
					normal : { 
						regexp : /[\u0410-\u042f][^.!?]*[.!? \t\n]*/g,
						push_text : function(arr, text, index) {
							arr.push({"index":index, "text":text});
						},
						get_text : function(arr_elem) {
							return "("+arr_elem.index+") "+arr_elem.text;	
						}
						
					}
				}
				this.mode = this.pfuncs[mode];
				
				this.parse_text = function() {
					var p = this.text.match(this.mode.regexp);
					console.dir(p);
					for(var index in p) {
						var text = p[index];
						this.mode.push_text(this.parsed, text, index);
					}
				}
				this.get_indexed =  function() {
					var r = "";
					if(this.mode.adj_indexes)
						this.mode.adj_indexes(this.parsed);
						
					for(var index in this.parsed) {
						var e = this.parsed[index];
						r += this.mode.get_text(e);
					}
					return r;
				}
				
				this.parse_text();
				
				return this;
			}
			$('button').click(function(e){
				e.preventDefault();								
				var area = $('textarea');
				var p = new Parser(area.val(), $(this).val());
				var indexed = p.get_indexed();
				if(indexed)
					area.val(indexed);
			});
		})
	</script>
	<style>
	</style>
</head>
<style>
textarea {
	width:100%; 
	height:50%
}
button, textarea{
	border-width: 1px;
	border-style: solid;
	-moz-border-top-colors: none;
	-moz-border-right-colors: none;
	-moz-border-bottom-colors: none;
	-moz-border-left-colors: none;
	border-image: none;
	border-color: rgb(192, 192, 192) rgb(217, 217, 217) rgb(217, 217, 217);
}
button:hover{
	background: #ddd;
}
</style>
<body >

	<textarea name="text">
	Вставте сюда текст. Нажмите "Пронумеровать" чтобы пронумеровать предложения. 
	Если где-то появилась лишная цифра: удалите её и нажмите "Перенумеровать".
	</textarea>
	<button value="normal"> Пронумеровать </button>
	<button value="reparse"> Перенумеровать </button>

</body>


